Creating a cluster
    - kind create cluster --name aiops-demo --config kind-config.yaml

Check Cluster running
    joshhannon@Mac-6451 kub_fail % kubectl cluster-info
    Kubernetes control plane is running at https://127.0.0.1:50626
    CoreDNS is running at https://127.0.0.1:50626/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

    To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.

# Add Helm repos
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add grafana https://grafana.github.io/helm-charts
helm repo update

helm install prometheus prometheus-community/kube-prometheus-stack \
  --namespace monitoring \
  --create-namespace \
  --set prometheus.prometheusSpec.serviceMonitorSelectorNilUsesHelmValues=false \
  --set prometheus.service.type=NodePort \
  --set prometheus.service.nodePort=30090 \
  --set grafana.service.type=NodePort \
  --set grafana.service.nodePort=30000


helm install loki grafana/loki \
  --namespace monitoring \
  --version 5.47.2 \
  --set loki.auth_enabled=false \
  --set loki.commonConfig.replication_factor=1 \
  --set loki.storage.type=filesystem \
  --set singleBinary.replicas=1

helm install promtail grafana/promtail \
  --namespace monitoring \
  --set config.lokiAddress=http://loki:3100/loki/api/v1/push

# Get Grafana Password
kubectl get secret -n monitoring prometheus-grafana -o jsonpath="{.data.admin-password}" | base64 --decode ; echo

Open Grafana at http://localhost:3000
Login with admin / <password>
Go to Connections → Data Sources → Add data source
Select "Loki"
Set URL to: http://loki:3100
Click "Save & Test"


# Test backend directly
curl http://localhost:8080/api/health
curl http://localhost:8080/api/data

# Generate some load
for i in {1..100}; do curl http://localhost:8080/api/data; done

# Check logs
kubectl logs -n aiops-demo -l app=backend --tail=20

# Check metrics in Prometheus
# Go to http://localhost:9090 and query: flask_http_request_total